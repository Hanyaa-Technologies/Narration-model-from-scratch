<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Text-to-Speech Converter</title>
  <!-- favicon: -->
  <link
    rel="icon"
    type="image/png"
    sizes="32x32"
    href="{{ url_for('static', filename='SVG/normal.svg') }}"
  />
  <!-- Bootstrap CSS + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    /* Body and background blobs */
    body {
      position: relative;
      background: #1e747c;
      /* solid teal */
      min-height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem 0;
    }

    body::before,
    body::after {
      background: rgba(255, 255, 255, 0.1);
    }

    body::before {
      width: 600px;
      height: 600px;
      border-radius: 50% 40% 60% 50%;
      top: -200px;
      left: -150px;
      transform: rotate(30deg);
    }

    body::after {
      width: 700px;
      height: 700px;
      border-radius: 40% 60% 50% 60%;
      bottom: -250px;
      right: -200px;
      transform: rotate(-45deg);
    }

    /* Additional floating shapes */
    .shape {
      position: absolute;
      background: rgba(255, 255, 255, 0.15);
    }

    .shape1 {
      width: 200px;
      height: 200px;
      border-radius: 60% 40% 70% 50%;
      top: 20%;
      left: 10%;
      transform: rotate(15deg);
    }

    .shape2 {
      width: 150px;
      height: 150px;
      border-radius: 50% 60% 40% 70%;
      bottom: 15%;
      left: 20%;
      transform: rotate(-25deg);
    }

    .shape3 {
      width: 180px;
      height: 180px;
      border-radius: 70% 50% 60% 40%;
      top: 25%;
      right: 15%;
      transform: rotate(45deg);
    }

    .shape4 {
      width: 120px;
      height: 120px;
      border-radius: 40% 70% 50% 60%;
      bottom: 20%;
      right: 25%;
      transform: rotate(-10deg);
    }

    /* Card styling */
    .card {
      position: relative;
      border: none;
      border-radius: 1rem;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      z-index: 1;
      max-width: 720px;
      width: 100%;
    }

    .card::before {
      content: "";
      position: absolute;
      width: 120px;
      height: 120px;
      background: rgba(41, 98, 255, 0.3);
      background: rgba(255, 255, 255, 0.3);
      border-radius: 30% 70% 50% 50%;
      top: -40px;
      right: -40px;
      transform: rotate(45deg);
    }

    .card::after {
      content: "";
      position: absolute;
      width: 100px;
      height: 100px;
      background: rgba(0, 200, 83, 0.3);
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50% 30% 70% 50%;
      bottom: -30px;
      left: -30px;
      transform: rotate(-30deg);
    }

    .card-header {
      border-top-left-radius: 1rem;
      border-top-right-radius: 1rem;
    }

    /* override Bootstrap primary header */
    .card-header.bg-primary {
      background-color: #1e747c !important;
    }

    /* override Bootstrap primary button */
    .btn-primary {
      background-color: #1e747c;
      border-color: #1e747c;
    }

    .btn-primary:hover {
      background-color: #17585a;
      border-color: #17585a;
    }

    .spinner-border {
      width: 3rem;
      height: 3rem;
    }

    /* Logo styles */
    .logo-container {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }

    .logo {
      height: 50px;
      width: auto;
      transition: transform 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.05);
    }
  </style>
</head>


<body>
  <!-- logo pinned topâ€‘left -->
  <img src="{{ url_for('static', filename='SVG/horizontal.svg') }}" alt="Logo"
    class="position-absolute top-0 start-0 m-2 logo">
    

  <!-- Floating shapes -->
  <div class="shape shape1"></div>
  <div class="shape shape2"></div>
  <div class="shape shape3"></div>
  <div class="shape shape4"></div>

  <div class="container d-flex justify-content-center">
    <div class="card shadow-lg">
      <div class="card-header bg-primary text-white text-center py-4">
        <h1 class="h3 mb-0">
          <i class="bi bi-mic-fill me-2"></i>
          Text-to-Speech Converter
        </h1>
      </div>
      <div class="card-body p-4">
        <form id="ttsForm">
          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <div class="form-floating">
                <select class="form-select" id="languageSelect" name="language" required>
                  <option value="" disabled selected>Choose language</option>
                  <option value="english">English</option>
                  <option value="hindi">Hindi</option>
                  <option value="telugu">Telugu</option>
                </select>
                <label for="languageSelect">Language</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <select class="form-select" id="speakerSelect" name="speaker" required disabled>
                  <option value="" disabled selected>Choose speaker</option>
                </select>
                <label for="speakerSelect">Speaker</label>
              </div>
            </div>
          </div>

          <div class="form-floating mb-4">
            <textarea class="form-control" id="textInput" name="text" placeholder="Type your text here"
              style="height: 150px" required></textarea>
            <label for="textInput">Enter Text</label>
          </div>

          <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
            <i class="bi bi-play-circle-fill me-2"></i>
            Generate Speech
          </button>
        </form>

        <!-- Loading Spinner -->
        <div id="loading" class="d-none justify-content-center my-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>

        <!-- Error Alert -->
        <div id="errorAlert" class="alert alert-danger d-none" role="alert"></div>

        <!-- Audio Player + Download -->
        <div id="audioContainer" class="d-none text-center">
          <audio id="audioPlayer" controls class="w-100 mb-3"></audio>
          <a id="downloadLink" href="#" download="output.wav" class="btn btn-success">
            <i class="bi bi-download me-1"></i>
            Download WAV
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS + unified script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function () {
      const form = document.getElementById("ttsForm");
      const loading = document.getElementById("loading");
      const errorAlert = document.getElementById("errorAlert");
      const audioContainer = document.getElementById("audioContainer");
      const audioPlayer = document.getElementById("audioPlayer");
      const downloadLink = document.getElementById("downloadLink");
      const languageSelect = document.getElementById("languageSelect");
      const speakerSelect = document.getElementById("speakerSelect");
      let currentController = null;

      async function loadSpeakers(language) {
        try {
          const res = await fetch(`/get_speakers?language=${encodeURIComponent(language)}`, { credentials: 'same-origin' });
          if (!res.ok) throw new Error('Failed to load speakers');
          const speakers = await res.json();

          speakerSelect.innerHTML = '<option value="" disabled selected>Choose speaker</option>';
          speakers.forEach(speaker => {
            speakerSelect.innerHTML += `
              <option value="${speaker}">
                ${speaker.replace('.npz', '')}
              </option>`;
          });
          speakerSelect.disabled = false;
        } catch (err) {
          console.error(err);
          speakerSelect.innerHTML = '<option value="">Error loading speakers</option>';
          speakerSelect.disabled = true;
        }
      }

      languageSelect.addEventListener('change', (e) => {
        if (e.target.value) loadSpeakers(e.target.value);
        else {
          speakerSelect.innerHTML = '<option value="" disabled selected>Choose speaker</option>';
          speakerSelect.disabled = true;
        }
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        errorAlert.classList.add("d-none");
        audioContainer.classList.add("d-none");

        if (!languageSelect.value || !speakerSelect.value) {
          errorAlert.textContent = "Please select both language and speaker.";
          errorAlert.classList.replace("d-none", "d-block");
          return;
        }

        if (currentController) currentController.abort();
        currentController = new AbortController();

        loading.classList.replace("d-none", "d-flex");

        try {
          const text = document.getElementById("textInput").value.trim();
          if (!text) throw new Error("Please enter some text.");

          const res = await fetch("/generate_audio", {
            method: "POST",
            credentials: 'same-origin',
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({
              text,
              language: languageSelect.value,
              speaker: speakerSelect.value
            }),
            signal: currentController.signal
          });

          if (!res.ok) {
            const err = await res.json();
            throw new Error(err.error || "Generation failed");
          }

          const blob = await res.blob();
          const url = URL.createObjectURL(blob);

          audioPlayer.src = url;
          downloadLink.href = url;
          audioContainer.classList.replace("d-none", "d-block");
        } catch (err) {
          if (err.name === 'AbortError') {
            console.log('Previous request aborted');
          } else {
            console.error(err);
            errorAlert.textContent = err.message;
            errorAlert.classList.replace("d-none", "d-block");
          }
        } finally {
          loading.classList.replace("d-flex", "d-none");
        }
      });
    })();
  </script>
</body>

</html>